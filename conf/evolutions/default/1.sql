# --- !Ups
CREATE TABLE polls (
  id SERIAL NOT NULL PRIMARY KEY,
  name VARCHAR NOT NULL,
  slug VARCHAR NOT NULL UNIQUE,
  description VARCHAR NOT NULL);

CREATE INDEX ON polls(slug);

CREATE TABLE alternatives (
  id SERIAL NOT NULL PRIMARY KEY,
  name VARCHAR NOT NULL,
  poll_id BIGINT NOT NULL REFERENCES polls(id) ON DELETE CASCADE
);

CREATE TABLE votes (
  id SERIAL NOT NULL PRIMARY KEY,
  username VARCHAR NOT NULL,
  poll_id BIGINT NOT NULL REFERENCES polls(id) ON DELETE CASCADE
);

CREATE TABLE notes (
  id SERIAL NOT NULL PRIMARY KEY,
  vote_id BIGINT NOT NULL REFERENCES votes(id) ON DELETE CASCADE,
  value INTEGER NOT NULL DEFAULT 50,
  alternative_id BIGINT NOT NULL REFERENCES alternatives(id)
);

# --- !Downs
DROP TABLE alternatives;
DROP TABLE notes;
DROP TABLE votes;
DROP TABLE polls;
