# --- !Ups

CREATE TABLE "polls" (
  "id" BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  "name" VARCHAR NOT NULL,
  "slug" VARCHAR NOT NULL UNIQUE,
  "description" VARCHAR NOT NULL,
  "last_modified" TIMESTAMP NOT NULL
);

CREATE INDEX ON "polls"("slug");

CREATE TABLE "alternatives" (
  "id" BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  "name" VARCHAR NOT NULL,
  "poll_id" BIGINT NOT NULL REFERENCES "polls"("id") ON DELETE CASCADE
);

CREATE TABLE "votes" (
  "id" BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  "user" VARCHAR NOT NULL,
  "poll_id" BIGINT NOT NULL REFERENCES "polls"("id") ON DELETE CASCADE
);

CREATE TABLE "notes" (
  "id" BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  "vote_id" BIGINT NOT NULL REFERENCES "votes"("id") ON DELETE CASCADE,
  "value" INTEGER DEFAULT 50 NOT NULL,
  "alternative_id" BIGINT NOT NULL REFERENCES "alternatives"("id")
);

# --- !Downs
DROP TABLE "alternatives";
DROP TABLE "notes";
DROP TABLE "votes";
DROP TABLE "polls"
