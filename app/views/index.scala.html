@(form: Form[Poll])

@alternativeField(field: Field, className: String = "alternative") = {
  @helper.input(field, '_label -> "alternatives", '_class -> className) { (id, name, value, _) =>
    <input type="text" name="@name" value="@value">
    <button type="button" class="remove-alternative">@Messages("remove")</button>
  }
}

@main(Messages("page.title.create")) {

  @if(form.hasErrors) {
    <div>Oops. Please fix all errors</div>
  }

  @helper.form(action = routes.Chooze.createPoll()) {

    @helper.inputText( form("name"), 'label -> Messages("name"))
    @helper.textarea(form("description"), 'label -> Messages("description"), 'rows -> 5, 'cols -> 50)

    <div class="alternatives">
      @helper.repeat(form("alternatives"), min = 2) { alternative =>
        @alternativeField(alternative("name"))
      }

      @alternativeField(form("alternatives[x].name"), className = "alternative_template")

      <button type="button" class="add-alternative">@Messages("addAlternative")</button>
    </div>

    <div>
      <input type="submit" value="@Messages("create")">
    </div>
  }

  <script type="text/javascript" charset="utf-8">
    (function() {
      $("form").on('click', '.remove-alternative', function (e) {
        var alternatives = $(this).parents(".alternatives")
  
        if ($(".alternative").size() > 2) {
          $(this).parents(".alternative").remove()
          renumber(alternatives)
        }
  
        return false
      });
  
      $(".add-alternative").on("click", function (e) {
        var alternatives = $(this).parents(".alternatives");
        var template = $(".alternative_template", alternatives);

        template.before("<div class=\"clearfix alternative\">" + template.html() + "</div>");
        renumber(alternatives);
        return false
      })
  
      var renumber = function (alternatives) {
        $(".alternative input").each(function (i) {
          $(this).attr("name", $(this).attr("name").replace(/alternatives\[.+\]/g, "alternatives[" + i + "]"))
        })
      };
    })();
  </script>
}
